---
name: workorder-system
---

# å·¥å•ç³»ç»Ÿ Skill

## Description

å·¥å•ç³»ç»Ÿæ“ä½œèƒ½åŠ›ï¼šæŸ¥è¯¢å¾…åŠå·¥å•ã€æå–å·¥å•è¯¦ç»†ä¿¡æ¯ã€æŸ¥çœ‹å·¥å•çŠ¶æ€ã€æŒ‰ä¸šåŠ¡ç±»å‹åˆ†ç»„å¯¼å‡ºå·¥å•æ•°æ®ã€‚æ”¯æŒæ™ºèƒ½ç™»å½•æ£€æµ‹ï¼Œè‡ªåŠ¨ç­‰å¾…ç”¨æˆ·ç™»å½•ï¼Œæ— éœ€æ‰‹åŠ¨ç¡®è®¤ã€‚æ”¯æŒå¤šç§ä¸šåŠ¡ç±»å‹ï¼Œè‡ªåŠ¨è¯†åˆ«å¹¶ç”Ÿæˆå¯¹åº”æ ¼å¼çš„ CSV æ–‡ä»¶ã€‚

## ç³»ç»Ÿèƒ½åŠ›

è¿™ä¸ª skill æä¾›å·¥å•ç³»ç»Ÿçš„ä»¥ä¸‹èƒ½åŠ›ï¼š

### æ ¸å¿ƒåŠŸèƒ½

1. **æŸ¥è¯¢å¾…åŠå·¥å•** - è·å–æ‰€æœ‰å¾…å¤„ç†çš„å·¥å•åˆ—è¡¨
2. **æå–å·¥å•è¯¦æƒ…** - æå–æ¯ä¸ªå·¥å•çš„å®Œæ•´ä¿¡æ¯
3. **è§£é™¤æ•æ„Ÿä¿¡æ¯æ©ç ** - è‡ªåŠ¨ç‚¹å‡»å°çœ¼ç›æŒ‰é’®æ˜¾ç¤ºå®Œæ•´æ•°æ®
4. **æŒ‰ä¸šåŠ¡ç±»å‹åˆ†ç»„** - è‡ªåŠ¨è¯†åˆ«ä¸šåŠ¡ç±»å‹å¹¶åˆ†ç»„
5. **æ™ºèƒ½å¯¼å‡ºæ•°æ®** - æ ¹æ®ä¸šåŠ¡ç±»å‹ç”Ÿæˆä¸åŒæ ¼å¼çš„ CSV æ–‡ä»¶
6. **è‹±æ–‡æ–‡ä»¶å‘½å** - ä½¿ç”¨è‹±æ–‡æ–‡ä»¶åï¼Œä¾¿äºç³»ç»Ÿå¤„ç†

### æ”¯æŒçš„å·¥å•ç±»å‹

- **è´·æ¬¾äº§å“å–æ¶ˆé¢åº¦** - åŒ…å«äº§å“å­—æ®µï¼ˆæœ€å¤š 10 ä¸ªäº§å“ï¼‰
- **å®šæœŸè´·æ¬¾è§£é”** - åŒ…å«å€Ÿæ®å·å­—æ®µï¼ˆæœ€å¤š 10 ä¸ªå€Ÿæ®å·ï¼‰
- **ä¼ä¸šè´·å·¥å•**ï¼ˆå«è€ä¸ªè´·ï¼‰
- **æ–°ä¸ªè´·å·¥å•**
- **å…¶ä»–ä¸šåŠ¡ç±»å‹å·¥å•**

### å¯æå–çš„å·¥å•å­—æ®µ

#### é€šç”¨å­—æ®µ

- ä»»åŠ¡å•ç¼–å·
- ä¸šåŠ¡ç±»å‹
- äº§å“ç±»å‹
- ä¼ä¸šåç§°/å®¢æˆ·åç§°
- CCIFï¼ˆå¯¹å…¬å®¢æˆ·ç¼–å·ï¼‰
- ECIFï¼ˆä¸ªäººå®¢æˆ·ç¼–å·ï¼‰
- æ ¸èº«é€šè¿‡çŠ¶æ€
- æ•°æ®ç±»å‹ï¼ˆä¼ä¸š/ä¸ªäººï¼‰

#### è´·æ¬¾äº§å“å–æ¶ˆé¢åº¦ä¸“ç”¨å­—æ®µ

- äº§å“ 1 ~ äº§å“ 10ï¼ˆæœ€å¤š 10 ä¸ªäº§å“ï¼‰

#### å®šæœŸè´·æ¬¾è§£é”ä¸“ç”¨å­—æ®µ

- å€Ÿæ®å· 1 ~ å€Ÿæ®å· 10ï¼ˆæœ€å¤š 10 ä¸ªå€Ÿæ®å·ï¼‰

## Usage

å½“ç”¨æˆ·éœ€è¦ä»å·¥å•ç³»ç»Ÿè·å–æ•°æ®æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨æ­¤ skillã€‚

## Trigger Phrases

ç”¨æˆ·å¯ä»¥ç”¨ä»¥ä¸‹è‡ªç„¶è¯­è¨€è§¦å‘æ­¤ skillï¼š

- "æŸ¥è¯¢å·¥å•ç³»ç»Ÿçš„å¾…åŠå·¥å•"
- "æå–å·¥å•æ•°æ®"
- "ä»å·¥å•ç³»ç»Ÿè·å–æ‰€æœ‰å¾…åŠä»»åŠ¡"
- "å¯¼å‡ºå·¥å•åˆ—è¡¨"
- "æŸ¥çœ‹å¾…åŠå·¥å•"
- "è·å–å·¥å•ç³»ç»Ÿæ•°æ®"
- "å¸®æˆ‘æå–å·¥å•ä¿¡æ¯"

## Instructions

ä½ æ˜¯ä¸€ä¸ªå·¥å•ç³»ç»Ÿæ“ä½œåŠ©æ‰‹ã€‚å½“ç”¨æˆ·è¯·æ±‚ä»å·¥å•ç³»ç»Ÿè·å–æ•°æ®æ—¶ï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ‰§è¡Œï¼š

**é‡è¦æç¤º**ï¼š

- æ‰€æœ‰æ–‡ä»¶ç”Ÿæˆï¼ˆJSONã€CSVã€æŠ¥å‘Šï¼‰éƒ½è‡ªåŠ¨å®Œæˆï¼Œæ— éœ€è¯¢é—®ç”¨æˆ·
- å®Œæˆåç›´æ¥å‘ç”¨æˆ·å±•ç¤ºæå–ç»“æœæ±‡æ€»å³å¯
- **ä½¿ç”¨ Playwright MCP å·¥å…·æ—¶ï¼Œå¿…é¡»éµå¾ªæ­£ç¡®çš„å‚æ•°æ ¼å¼**ï¼ˆè§ä¸‹æ–¹å·¥å…·ä½¿ç”¨è¯´æ˜ï¼‰

## âš ï¸ å…³é”®ï¼šPlaywright MCP å·¥å…·æ­£ç¡®ç”¨æ³•ï¼ˆå¿…è¯»ï¼‰

### å¿«é€Ÿå‚è€ƒ

**`browser_run_code` å·¥å…·**ï¼š
```json
{
  "code": "å®Œæ•´çš„ JavaScript ä»£ç å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ \\n åˆ†éš”å¤šè¡Œ"
}
```

**`browser_evaluate` å·¥å…·**ï¼š
```json
{
  "function": "() => { return document.title; }",
  "args": []  // å¯é€‰
}
```

### å¸¸è§é”™è¯¯

âŒ **é”™è¯¯ 1**ï¼šç›´æ¥å†™ä»£ç 
```javascript
// è¿™æ ·ä¼šæŠ¥é”™ï¼šSyntaxError: Unexpected token 'async'
async function checkLogin() {
  const url = page.url();
}
```

âœ… **æ­£ç¡®**ï¼šä»£ç æ”¾åœ¨å­—ç¬¦ä¸²ä¸­
```json
{
  "code": "const url = page.url();\nconst title = await page.title();\nreturn { url, title };"
}
```

âŒ **é”™è¯¯ 2**ï¼š`browser_evaluate` å‚æ•°é”™è¯¯
```json
{
  "function": undefined  // ä¼šæŠ¥é”™ï¼šexpected string, received undefined
}
```

âœ… **æ­£ç¡®**ï¼š
```json
{
  "function": "() => { return document.title; }"
}
```

## Playwright MCP å·¥å…·ä½¿ç”¨è¯´æ˜

### `browser_run_code` å·¥å…·

**æ­£ç¡®ç”¨æ³•**ï¼šä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•° `code`ï¼ŒåŒ…å«å®Œæ•´çš„ JavaScript ä»£ç 

```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ code å‚æ•°ä¼ é€’å­—ç¬¦ä¸²
{
  "code": "await page.goto('http://example.com');\nawait page.waitForLoadState('networkidle');"
}

// âŒ é”™è¯¯ï¼šç›´æ¥å†™ä»£ç ï¼ˆä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ï¼‰
async function checkLoginStatus() { ... }  // è¿™æ ·ä¼šæŠ¥é”™
```

**é‡è¦è§„åˆ™**ï¼š
- ä»£ç å¿…é¡»æ˜¯**å­—ç¬¦ä¸²æ ¼å¼**ï¼Œæ”¾åœ¨ `code` å‚æ•°ä¸­
- ä»£ç ä¸­å¯ä»¥ä½¿ç”¨ `page` å¯¹è±¡ï¼ˆPlaywright Page å®ä¾‹ï¼‰
- ä»£ç ä¸­å¯ä»¥ä½¿ç”¨ `await` å’Œ `async`ï¼Œä½†æ•´ä¸ªä»£ç å—å¿…é¡»æ˜¯å­—ç¬¦ä¸²
- å¤šè¡Œä»£ç ç”¨ `\n` åˆ†éš”

**ç¤ºä¾‹**ï¼š
```javascript
// æ£€æµ‹ç™»å½•çŠ¶æ€
{
  "code": "const url = page.url();\nconst title = await page.title();\nconst isLoggedIn = !url.includes('/pmbank-um/') && !title.includes('ç»Ÿä¸€ç™»å½•å¹³å°');\nreturn isLoggedIn;"
}
```

### `browser_evaluate` å·¥å…·

**æ­£ç¡®ç”¨æ³•**ï¼šä¼ é€’ä¸€ä¸ªå‡½æ•°å­—ç¬¦ä¸²åˆ° `function` å‚æ•°

```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ function å‚æ•°ä¼ é€’å‡½æ•°å­—ç¬¦ä¸²
{
  "function": "() => { return document.title; }"
}

// âœ… æ­£ç¡®ï¼šå¸¦å‚æ•°çš„å‡½æ•°
{
  "function": "(el) => { return el.innerText; }",
  "args": [{"uid": "element-uid-123"}]
}

// âŒ é”™è¯¯ï¼šç›´æ¥ä¼ ä»£ç æˆ– undefined
{
  "function": undefined  // ä¼šæŠ¥é”™ "expected string, received undefined"
}
```

### æ­¥éª¤ 1ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶ç­‰å¾…ç™»å½•

1. **ä½¿ç”¨ Playwright MCP å¯¼èˆªåˆ°å·¥å•ç³»ç»Ÿç™»å½•é¡µé¢**ï¼š

   ä½¿ç”¨ `mcp__playwright__browser_navigate` å·¥å…·ï¼š
   ```
   URL: http://k.test-adm.weoa.com/pmbank-um/index.html?target=https%3A%2F%2Fk.test-adm.weoa.com%2Fs%2Frcs-ucsportalweb%2F%23%2F%3Fsso_ticket%3Df4cd540a7c30169660eb64c48fbef16346b4fd98ee177462921b183dbafbd265%26
   ```

2. **è‡ªåŠ¨æ£€æµ‹ç™»å½•çŠ¶æ€**ï¼š

   ä½¿ç”¨ `mcp__playwright__browser_run_code` å·¥å…·ï¼Œ**æ­£ç¡®æ ¼å¼**ï¼š
   ```javascript
   {
     "code": "const url = page.url();\nconst title = await page.title();\nconst hasLoginForm = (await page.locator('input[type=\"password\"], button:has-text(\"ç™»\")').count()) > 0;\nconst hasMainUI = (await page.locator('text=Welcome!, text=å·¥å•ç³»ç»Ÿ').count()) > 0;\nconst isLoggedIn = !url.includes('/pmbank-um/') && !title.includes('ç»Ÿä¸€ç™»å½•å¹³å°') && !hasLoginForm && hasMainUI;\nreturn { isLoggedIn, url, title };"
   }
   ```

   - æ£€æŸ¥é¡µé¢ URL æ˜¯å¦åŒ…å« `/pmbank-um/` æˆ– `login`ï¼ˆæœªç™»å½•æ ‡å¿—ï¼‰
   - æ£€æŸ¥é¡µé¢æ ‡é¢˜æ˜¯å¦åŒ…å«"ç»Ÿä¸€ç™»å½•å¹³å°"ï¼ˆæœªç™»å½•æ ‡å¿—ï¼‰
   - æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç™»å½•è¡¨å•ï¼š`input[type="password"]` æˆ– `button:has-text("ç™»")`ï¼ˆæœªç™»å½•æ ‡å¿—ï¼‰
   - æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸»ç•Œé¢å…ƒç´ ï¼š`text=Welcome!` æˆ– `text=å·¥å•ç³»ç»Ÿ`ï¼ˆå·²ç™»å½•æ ‡å¿—ï¼‰

3. **å¦‚æœæœªç™»å½•**ï¼š

   - è¾“å‡ºæç¤ºï¼š"â³ ç­‰å¾…ç”¨æˆ·ç™»å½•å·¥å•ç³»ç»Ÿ..."
   - è¾“å‡ºæç¤ºï¼š"ğŸ’¡ æç¤ºï¼šè¯·åœ¨æµè§ˆå™¨ä¸­å®Œæˆç™»å½•æ“ä½œ"
   - æ¯éš” 3 ç§’ä½¿ç”¨ `browser_run_code` é‡æ–°æ£€æµ‹ä¸€æ¬¡ç™»å½•çŠ¶æ€ï¼ˆä½¿ç”¨ä¸Šé¢çš„ä»£ç ï¼‰
   - æœ€å¤šç­‰å¾… 5 åˆ†é’Ÿï¼ˆ300 ç§’ï¼‰
   - æ£€æµ‹åˆ°ç™»å½•æˆåŠŸåï¼Œè¾“å‡ºï¼š"âœ… æ£€æµ‹åˆ°ç”¨æˆ·å·²ç™»å½•"
   - **æ™ºèƒ½ç­‰å¾…ä¸»ç•Œé¢å®Œå…¨åŠ è½½**ï¼ˆä½¿ç”¨ `browser_run_code`ï¼‰ï¼š
     ```javascript
     {
       "code": "await page.waitForLoadState('networkidle');\nawait page.locator('svg').first().waitFor({ state: 'visible', timeout: 10000 });\nlet stableCount = 0;\nlet lastSize = 0;\nfor (let i = 0; i < 10; i++) {\n  await new Promise(resolve => setTimeout(resolve, 500));\n  const currentSize = (await page.evaluate(() => document.body.innerHTML.length));\n  if (currentSize === lastSize) {\n    stableCount++;\n    if (stableCount >= 3) break;\n  } else {\n    stableCount = 0;\n  }\n  lastSize = currentSize;\n}\nawait new Promise(resolve => setTimeout(resolve, 1000));\nreturn 'ä¸»ç•Œé¢åŠ è½½å®Œæˆ';"
     }
     ```
   - è¾“å‡ºï¼š"âœ… ä¸»ç•Œé¢åŠ è½½å®Œæˆ"
   - è‡ªåŠ¨ç»§ç»­æ‰§è¡Œåç»­æ­¥éª¤

4. **å¦‚æœå·²ç™»å½•**ï¼š
   - è¾“å‡ºï¼š"âœ… å·²ç™»å½•å·¥å•ç³»ç»Ÿ"
   - æ‰§è¡Œç›¸åŒçš„æ™ºèƒ½ç­‰å¾…ä¸»ç•Œé¢åŠ è½½æµç¨‹ï¼ˆä½¿ç”¨ä¸Šé¢çš„ `browser_run_code`ï¼‰
   - è¾“å‡ºï¼š"âœ… ä¸»ç•Œé¢åŠ è½½å®Œæˆ"
   - ç›´æ¥ç»§ç»­æ‰§è¡Œåç»­æ­¥éª¤

### æ­¥éª¤ 2ï¼šè¿›å…¥å¾…å¤„ç†ä»»åŠ¡é¡µé¢ï¼ˆå¸¦é‡è¯•æœºåˆ¶ï¼‰

**é‡è¦ï¼šæ‰€æœ‰å…³é”®ç‚¹å‡»æ“ä½œéƒ½ä½¿ç”¨å¸¦é‡è¯•æœºåˆ¶çš„ä»£ç ï¼Œé€šè¿‡ `browser_run_code` æ‰§è¡Œ**

1. **ç‚¹å‡»é¡¶éƒ¨ SVG å›¾æ ‡**ï¼ˆæœ€å¤šé‡è¯• 1 æ¬¡ï¼‰ï¼š

   ä½¿ç”¨ `mcp__playwright__browser_run_code` å·¥å…·ï¼Œ**æ­£ç¡®æ ¼å¼**ï¼š
   ```javascript
   {
     "code": "async function clickWithRetry(selector, maxRetries = 1) { for (let i = 0; i <= maxRetries; i++) { try { await page.locator(selector).first().waitFor({ state: 'visible', timeout: 2000 }); await page.locator(selector).first().waitFor({ state: 'attached', timeout: 2000 }); await page.locator(selector).first().click({ timeout: 2000 }); return true; } catch (e) { if (i === maxRetries) throw e; await new Promise(resolve => setTimeout(resolve, 2000)); } } } await clickWithRetry('svg'); await new Promise(resolve => setTimeout(resolve, 1000)); return 'ç‚¹å‡»æˆåŠŸ';"
   }
   ```

2. **ç‚¹å‡» `.top-header-item`**ï¼ˆæœ€å¤šé‡è¯• 1 æ¬¡ï¼‰ï¼š

   ä½¿ç”¨ç›¸åŒçš„é‡è¯•é€»è¾‘ï¼ˆä¸Šé¢çš„ä»£ç ï¼Œå°†é€‰æ‹©å™¨æ”¹ä¸º `.top-header-item`ï¼‰ï¼š
   ```javascript
   {
     "code": "async function clickWithRetry(selector, maxRetries = 1) { for (let i = 0; i <= maxRetries; i++) { try { await page.locator(selector).first().waitFor({ state: 'visible', timeout: 2000 }); await page.locator(selector).first().waitFor({ state: 'attached', timeout: 2000 }); await page.locator(selector).first().click({ timeout: 2000 }); return true; } catch (e) { if (i === maxRetries) throw e; await new Promise(resolve => setTimeout(resolve, 2000)); } } } await clickWithRetry('.top-header-item'); await new Promise(resolve => setTimeout(resolve, 1000)); return 'ç‚¹å‡»æˆåŠŸ';"
   }
   ```

3. **ç‚¹å‡»"å·¥å•ç³»ç»Ÿï¼ˆä¼é‡‘ï¼‰"**ï¼ˆæœ€å¤šé‡è¯• 1 æ¬¡ï¼‰ï¼š

   ä½¿ç”¨ç›¸åŒçš„é‡è¯•é€»è¾‘ï¼Œç„¶åç­‰å¾…é¡µé¢åŠ è½½ï¼š
   ```javascript
   {
     "code": "async function clickWithRetry(selector, maxRetries = 1) { for (let i = 0; i <= maxRetries; i++) { try { await page.locator(selector).first().waitFor({ state: 'visible', timeout: 2000 }); await page.locator(selector).first().waitFor({ state: 'attached', timeout: 2000 }); await page.locator(selector).first().click({ timeout: 2000 }); return true; } catch (e) { if (i === maxRetries) throw e; await new Promise(resolve => setTimeout(resolve, 2000)); } } } await clickWithRetry('text=å·¥å•ç³»ç»Ÿï¼ˆä¼é‡‘ï¼‰'); await page.waitForLoadState('networkidle'); await new Promise(resolve => setTimeout(resolve, 2000)); return 'ç‚¹å‡»æˆåŠŸï¼Œiframe å·²åŠ è½½';"
   }
   ```

4. **åœ¨ iframe ä¸­ç‚¹å‡»"å¾…å¤„ç†ä»»åŠ¡"**ï¼š
   ä½¿ç”¨ `browser_run_code`ï¼š
   ```javascript
   {
     "code": "const frame = page.frameLocator('iframe'); await frame.locator('text=å¾…å¤„ç†ä»»åŠ¡').first().click({ timeout: 3000 }); await page.waitForLoadState('networkidle'); await new Promise(resolve => setTimeout(resolve, 1000)); return 'å·²è¿›å…¥å¾…å¤„ç†ä»»åŠ¡é¡µé¢';"
   }
   ```

**å…³é”®ä¼˜åŒ–ç‚¹**ï¼š

- âœ… åœ¨å…³é”®æ­¥éª¤åä½¿ç”¨ `waitForLoadState('networkidle')` ç¡®ä¿é¡µé¢åŠ è½½å®Œæˆ

### æ­¥éª¤ 3ï¼šè·å–åˆ†é¡µä¿¡æ¯

1. **è¯»å–åˆ†é¡µä¿¡æ¯**ï¼š
   ä½¿ç”¨ `mcp__playwright__browser_run_code` å·¥å…·ï¼š
   ```javascript
   {
     "code": "const frame = page.frameLocator('iframe'); const paginationText = await frame.locator('.ant-pagination-total-text').textContent(); const match = paginationText.match(/å…±\\s*(\\d+)\\s*æ¡ï¼Œå…±\\s*(\\d+)\\s*é¡µ/); const totalPages = match ? parseInt(match[2]) : 1; return { totalPages, paginationText };"
   }
   ```
   - ä»"å…± X æ¡ï¼Œå…± Y é¡µ"ä¸­æå–é¡µæ•°
   - å¦‚æœè·å–å¤±è´¥ï¼Œå‡è®¾åªæœ‰ 1 é¡µ

### æ­¥éª¤ 4ï¼šéå†æ‰€æœ‰é¡µé¢å’Œå·¥å•(ä½¿ç”¨`extractAllWorkOrders`å‡½æ•°)

**é‡è¦ï¼šä½¿ç”¨æ­£ç¡®çš„å…ƒç´ å®šä½å™¨å’Œå®Œæ•´çš„è¿”å›åˆ—è¡¨æµç¨‹**

#### 4.1 éå†æ‰€æœ‰é¡µé¢

å¯¹äºæ¯ä¸€é¡µï¼š

1. **å¦‚æœä¸æ˜¯ç¬¬ä¸€é¡µï¼Œè·³è½¬åˆ°æŒ‡å®šé¡µ**ï¼š
   ä½¿ç”¨ `browser_run_code`ï¼š
   ```javascript
   {
     "code": "const frame = page.frameLocator('iframe'); try { await frame.locator(`.ant-pagination-item-${currentPage}`).click(); } catch (e) { await frame.locator('.ant-pagination-next:not(.ant-pagination-disabled)').click(); } await page.waitForLoadState('networkidle'); await new Promise(resolve => setTimeout(resolve, 1000)); return 'å·²è·³è½¬åˆ°ç¬¬ ' + currentPage + ' é¡µ';"
   }
   ```
   - ä¼˜å…ˆä½¿ç”¨é¡µç æŒ‰é’®ï¼Œå¤‡é€‰æ–¹æ¡ˆï¼šç‚¹å‡»"ä¸‹ä¸€é¡µ"æŒ‰é’®
   - ç­‰å¾… `page.waitForLoadState('networkidle')`
   - é¢å¤–ç­‰å¾… 1 ç§’

2. **è·å–å½“å‰é¡µçš„å·¥å•æ•°é‡**ï¼š
   ä½¿ç”¨ `browser_run_code`ï¼š
   ```javascript
   {
     "code": "const frame = page.frameLocator('iframe'); const count = await frame.locator('tr.ant-table-row').count(); return count;"
   }
   ```

#### 4.2 éå†å½“å‰é¡µçš„æ¯ä¸ªå·¥å•

å¯¹äºæ¯ä¸ªå·¥å•ï¼š

1. **ç‚¹å‡»å·¥å•ç¼–å·é“¾æ¥**ï¼š
   ä½¿ç”¨ `mcp__playwright__browser_run_code` å·¥å…·ï¼š
   ```javascript
   {
     "code": "const frame = page.frameLocator('iframe'); const links = frame.locator('a.case-link'); const linkCount = await links.count(); if (i >= linkCount) throw new Error('å·¥å•ç´¢å¼•è¶…å‡ºèŒƒå›´'); await links.nth(i).click(); await new Promise(resolve => setTimeout(resolve, 1000)); await page.waitForLoadState('networkidle'); return 'å·²ç‚¹å‡»å·¥å•é“¾æ¥';"
   }
   ```
   - **å…³é”®**ï¼šæ¯æ¬¡å¾ªç¯é‡æ–°è·å–å…ƒç´ å¼•ç”¨ï¼Œé¿å…å…ƒç´ å¼•ç”¨å¤±æ•ˆ
   - ç­‰å¾… 1 ç§’ + `waitForLoadState('networkidle')`

2. **è·å–ä»»åŠ¡å•ç¼–å·**ï¼š
   ä½¿ç”¨ `browser_run_code`ï¼š
   ```javascript
   {
     "code": "const frame = page.frameLocator('iframe'); const taskId = await frame.locator('.fes-tabs-tab').filter({ hasText: /^E/ }).first().textContent(); return taskId.trim();"
   }
   ```
   - ä»æ ‡ç­¾é¡µæ ‡é¢˜è·å–ï¼Œè€Œä¸æ˜¯ä»é“¾æ¥æ–‡æœ¬è·å–

3. **ç­‰å¾…å¤„ç†è®°å½•åŠ è½½**ï¼š
   ä½¿ç”¨ `browser_run_code`ï¼š
   ```javascript
   {
     "code": "await new Promise(resolve => setTimeout(resolve, 1500)); return 'ç­‰å¾…å®Œæˆ';"
   }
   ```

4. **ç‚¹å‡»"æŸ¥çœ‹"æŒ‰é’®**ï¼š
   ä½¿ç”¨ `browser_run_code`ï¼š
   ```javascript
   {
     "code": "const frame = page.frameLocator('iframe'); const viewButtons = frame.getByRole('button', { name: 'æŸ¥çœ‹', exact: true }); const count = await viewButtons.count(); if (count === 0) { return { found: false, error: 'æœªæ‰¾åˆ°æŸ¥çœ‹æŒ‰é’®' }; } await viewButtons.nth(count - 1).click(); return { found: true };"
   }
   ```
   - **ç‚¹å‡»æœ€åä¸€ä¸ª"æŸ¥çœ‹"æŒ‰é’®**ï¼ˆé¡µé¢å¯èƒ½æœ‰å¤šä¸ªæŸ¥çœ‹æŒ‰é’®ï¼‰
   - å¦‚æœæœªæ‰¾åˆ°æŸ¥çœ‹æŒ‰é’®ï¼š
     - è®°å½•ä¸ºéœ€è¦äººå·¥ç¡®è®¤çš„å·¥å•
     - **å…³é—­æ ‡ç­¾é¡µ**ï¼šä½¿ç”¨ `browser_run_code` æ‰§è¡Œå…³é—­æ“ä½œ
     - ç‚¹å‡»"å¾…å¤„ç†ä»»åŠ¡"è¿”å›åˆ—è¡¨
     - è·³è¿‡åç»­å¤„ç†ï¼Œç»§ç»­ä¸‹ä¸€ä¸ªå·¥å•

5. **ç‚¹å‡»å°çœ¼ç›æŒ‰é’®æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯**ï¼š
   ä½¿ç”¨ `browser_run_code`ï¼š
   ```javascript
   {
     "code": "const frame = page.frameLocator('iframe'); const modal = frame.locator('.fes-modal-wrapper').filter({ hasText: 'æŸ¥çœ‹è´·æ¬¾ä¿¡æ¯è®°å½•' }).first(); const eyeButton = modal.locator('.fes-grid').first().locator('.fes-grid-item').nth(1).locator('button.fes-btn-type-link').first(); await eyeButton.click(); return 'å·²ç‚¹å‡»å°çœ¼ç›æŒ‰é’®';"
   }
   ```

6. **æå–å¼¹çª—æ•°æ®**ï¼š
   - ä½¿ç”¨ `mcp__playwright__browser_evaluate` å·¥å…·æå–æ•°æ®ï¼Œ**æ­£ç¡®æ ¼å¼**ï¼š
     ```javascript
     {
       "function": "(el) => { function cleanText(text) { if (!text) return text; text = text.replace(/^\\\"(.*)\\\"$/, '$1'); text = text.replace(/\\\"\\\"/g, '\\\"'); text = text.replace(/[\\t\\n\\r]/g, ''); text = text.trim(); text = text.replace(/^[\\\"'\\s]+|[\\\"'\\s]+$/g, ''); return text; } const labels = el.querySelectorAll('.fes-form-item-label'); const values = el.querySelectorAll('.fes-form-item-content'); const data = { taskId: '', businessType: '', productType: '', companyName: '', customerName: '', ccif: '', ecif: '', authPassed: '', products: [], loanNumbers: [], dataType: '' }; for (let i = 0; i < labels.length; i++) { const label = labels[i].textContent.trim().replace('ï¼š', '').replace(':', ''); const value = values[i].textContent.trim(); if (label.includes('ä¸šåŠ¡ç±»å‹')) data.businessType = value; else if (label.includes('äº§å“ç±»å‹')) data.productType = value; else if (label.includes('ä¼ä¸šåç§°')) data.companyName = cleanText(value); else if (label.includes('å®¢æˆ·åç§°') || label.includes('å§“å')) data.customerName = cleanText(value); else if (label.includes('CCIF')) data.ccif = value; else if (label.includes('ECIF')) data.ecif = value; else if (label.includes('æ ¸èº«é€šè¿‡')) data.authPassed = value; else if (label.match(/äº§å“\\d+/)) data.products.push(value); else if (label.match(/å€Ÿæ®å·\\d+/)) data.loanNumbers.push(value); } if (data.ccif) data.dataType = 'ä¼ä¸š'; else if (data.ecif) data.dataType = 'ä¸ªäºº'; return data; }",
       "args": [{"uid": "modal-element-uid"}]
     }
     ```
   - æå–ï¼šä¸šåŠ¡ç±»å‹ã€äº§å“ç±»å‹ã€ä¼ä¸šåç§°ã€å®¢æˆ·åç§°ï¼ˆæˆ–å§“åï¼‰ã€CCIFã€ECIFã€æ ¸èº«é€šè¿‡ã€äº§å“ 1-10ã€å€Ÿæ®å· 1-10
   - **é‡è¦**ï¼šå®¢æˆ·åç§°å­—æ®µå¯èƒ½æ˜¯"å®¢æˆ·åç§°"æˆ–"å§“å"ï¼Œéœ€è¦åŒæ—¶å°è¯•æå–
   - **é‡è¦**ï¼šæå–åç«‹å³æ¸…ç†ä¼ä¸šåç§°å’Œå®¢æˆ·åç§°ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆåˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ã€å¤šä½™å¼•å·ï¼‰

7. **å…³é—­å¼¹çª—**ï¼š
   ä½¿ç”¨ `browser_run_code`ï¼š
   ```javascript
   {
     "code": "const frame = page.frameLocator('iframe'); const modal = frame.locator('.fes-modal-wrapper').filter({ hasText: 'æŸ¥çœ‹è´·æ¬¾ä¿¡æ¯è®°å½•' }).first(); await modal.locator('.fes-modal-close').click(); await new Promise(resolve => setTimeout(resolve, 300)); return 'å¼¹çª—å·²å…³é—­';"
   }
   ```

8. **å…³é—­æ ‡ç­¾é¡µå¹¶è¿”å›åˆ—è¡¨**ï¼ˆå…³é”®æ­¥éª¤ï¼‰ï¼š
   ä½¿ç”¨ `browser_run_code`ï¼š
   ```javascript
   {
     "code": "const frame = page.frameLocator('iframe'); await frame.locator('div:nth-child(3) > .fes-tabs-tab-close').click(); await new Promise(resolve => setTimeout(resolve, 300)); await frame.locator('div').filter({ hasText: /^å¾…å¤„ç†ä»»åŠ¡$/ }).first().click(); await page.waitForLoadState('networkidle'); await new Promise(resolve => setTimeout(resolve, 500)); return 'å·²è¿”å›åˆ—è¡¨';"
   }
   ```

#### 4.3 é”™è¯¯å¤„ç†

å¦‚æœå¤„ç†å·¥å•æ—¶å‡ºé”™ï¼š

1. è®°å½•é”™è¯¯ä¿¡æ¯å’Œå·¥å•ç´¢å¼•
2. **ä¸é€’å¢ globalIndex**ï¼ˆé¿å…ç´¢å¼•è·³è·ƒï¼‰
3. **å°è¯•è¿”å›åˆ—è¡¨**ï¼š
   ä½¿ç”¨ `browser_run_code`ï¼ŒåŒ…å«é”™è¯¯å¤„ç†ï¼š
   ```javascript
   {
     "code": "const frame = page.frameLocator('iframe'); try { await frame.locator('div:nth-child(3) > .fes-tabs-tab-close').click().catch(() => {}); } catch (e) {} try { await frame.locator('div').filter({ hasText: /^å¾…å¤„ç†ä»»åŠ¡$/ }).first().click(); await page.waitForLoadState('networkidle'); } catch (e) {} return 'å·²å°è¯•è¿”å›åˆ—è¡¨';"
   }
   ```
4. ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªå·¥å•

### æ­¥éª¤ 5ï¼šæŒ‰ä¸šåŠ¡ç±»å‹åˆ†ç»„

è‡ªåŠ¨è¯†åˆ«ä¸šåŠ¡ç±»å‹å¹¶åˆ†ç»„ï¼š

- è¯»å–æ¯ä¸ªå·¥å•çš„"ä¸šåŠ¡ç±»å‹"å­—æ®µ
- å°†ç›¸åŒä¸šåŠ¡ç±»å‹çš„å·¥å•å½’ä¸ºä¸€ç»„
- æ”¯æŒçš„ä¸šåŠ¡ç±»å‹ï¼š
  - è´·æ¬¾äº§å“å–æ¶ˆé¢åº¦ â†’ `workorders_cancel_credit_limit.csv`
  - å®šæœŸè´·æ¬¾è§£é” â†’ `workorders_unlock_term_loan.csv`
  - å…¶ä»–ç±»å‹ â†’ `workorders_<type>.csv`

### æ­¥éª¤ 6ï¼šç”Ÿæˆ CSV æ–‡ä»¶

**é‡è¦ï¼šä½¿ç”¨ `generate-csv.js` è„šæœ¬ç”Ÿæˆ CSV æ–‡ä»¶**

æ ¹æ®ä¸šåŠ¡ç±»å‹ç”Ÿæˆä¸åŒæ ¼å¼çš„ CSV æ–‡ä»¶ï¼Œ**åˆ—æ•°æ ¹æ®å®é™…æ•°æ®åŠ¨æ€ç”Ÿæˆ**ï¼š

#### ä½¿ç”¨æ–¹æ³•

```bash
node .claude/skills/workorder-system/generate-csv.js workorders_raw.json [è¾“å‡ºç›®å½•]
```

#### åŠŸèƒ½ç‰¹æ€§

1. **åŠ¨æ€åˆ—æ•°ç”Ÿæˆ**ï¼š

   - è‡ªåŠ¨æ£€æµ‹å®é™…æ•°æ®ä¸­çš„æœ€å¤§äº§å“æ•°/å€Ÿæ®å·æ•°
   - åªç”Ÿæˆéœ€è¦çš„åˆ—ï¼Œé¿å…ç©ºåˆ—
   - ä¾‹å¦‚ï¼šå¦‚æœæœ€å¤šæœ‰ 3 ä¸ªå€Ÿæ®å·ï¼Œåªç”Ÿæˆ 3 åˆ—å€Ÿæ®å·

2. **æ•°æ®æ¸…ç†**ï¼š

   - è‡ªåŠ¨æ¸…ç†ä¼ä¸šåç§°ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆåˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ã€å¤šä½™å¼•å·ç­‰ï¼‰
   - å»é™¤å‰åç©ºæ ¼
   - ç¡®ä¿æ•°æ®æ ¼å¼ç»Ÿä¸€

3. **æ–‡ä»¶å‘½å**ï¼š
   - è´·æ¬¾äº§å“å–æ¶ˆé¢åº¦ â†’ `workorders_cancel_credit_limit.csv`
   - å®šæœŸè´·æ¬¾è§£é” â†’ `workorders_unlock_term_loan.csv`

#### è´·æ¬¾äº§å“å–æ¶ˆé¢åº¦ï¼ˆåŠ¨æ€åˆ—æ•°ï¼‰

åŸºç¡€åˆ—ï¼ˆ9 åˆ—ï¼‰+ äº§å“åˆ—ï¼ˆåŠ¨æ€ï¼‰+ æ•°æ®ç±»å‹ï¼ˆ1 åˆ—ï¼‰

```csv
ä»»åŠ¡å•ç¼–å·,ä¸šåŠ¡ç±»å‹,äº§å“ç±»å‹,ä¼ä¸šåç§°,å®¢æˆ·åç§°,CCIF,ECIF,æ ¸èº«é€šè¿‡,äº§å“1,[äº§å“2,äº§å“3,...],æ•°æ®ç±»å‹
```

**ç¤ºä¾‹**ï¼šå¦‚æœå®é™…æœ€å¤šæœ‰ 1 ä¸ªäº§å“ï¼Œåˆ™ç”Ÿæˆ 10 åˆ—

#### å®šæœŸè´·æ¬¾è§£é”ï¼ˆåŠ¨æ€åˆ—æ•°ï¼‰

åŸºç¡€åˆ—ï¼ˆ9 åˆ—ï¼‰+ å€Ÿæ®å·åˆ—ï¼ˆåŠ¨æ€ï¼‰+ æ•°æ®ç±»å‹ï¼ˆ1 åˆ—ï¼‰

```csv
ä»»åŠ¡å•ç¼–å·,ä¸šåŠ¡ç±»å‹,äº§å“ç±»å‹,ä¼ä¸šåç§°,å®¢æˆ·åç§°,CCIF,ECIF,æ ¸èº«é€šè¿‡,å€Ÿæ®å·1,[å€Ÿæ®å·2,å€Ÿæ®å·3,...],æ•°æ®ç±»å‹
```

**ç¤ºä¾‹**ï¼šå¦‚æœå®é™…æœ€å¤šæœ‰ 3 ä¸ªå€Ÿæ®å·ï¼Œåˆ™ç”Ÿæˆ 12 åˆ—

### æ­¥éª¤ 7ï¼šè¾“å‡ºç»“æœ

**è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Šå’Œæ–‡ä»¶ï¼Œæ— éœ€è¯¢é—®ç”¨æˆ·**

1. è‡ªåŠ¨ä¿å­˜åŸå§‹ JSON æ•°æ®åˆ° `workorders_raw.json`
2. è‡ªåŠ¨ç”Ÿæˆ CSV æ–‡ä»¶ï¼ˆæŒ‰ä¸šåŠ¡ç±»å‹åˆ†ç»„ï¼‰
3. è‡ªåŠ¨ç”Ÿæˆå·¥å•æå–æŠ¥å‘Š `å·¥å•æå–æŠ¥å‘Š.txt`ï¼ŒåŒ…å«ï¼š
   - æ€»å·¥å•æ•°
   - å„ä¸šåŠ¡ç±»å‹çš„å·¥å•æ•°é‡
   - ç”Ÿæˆçš„ CSV æ–‡ä»¶åˆ—è¡¨ï¼ˆæ–‡ä»¶åã€è®°å½•æ•°ã€æ–‡ä»¶è·¯å¾„ï¼‰
   - éœ€è¦äººå·¥ç¡®è®¤çš„å·¥å•åˆ—è¡¨ï¼ˆå¦‚æœ‰ï¼‰
   - ä¼˜åŒ–æ•ˆæœéªŒè¯ä¿¡æ¯

## Configuration

```javascript
const config = {
  loginUrl:
    "http://k.test-adm.weoa.com/pmbank-um/index.html?target=https%3A%2F%2Fk.test-adm.weoa.com%2Fs%2Frcs-ucsportalweb%2F%23%2F%3Fsso_ticket%3Df4cd540a7c30169660eb64c48fbef16346b4fd98ee177462921b183dbafbd265%26",
  systemName: "å·¥å•ç³»ç»Ÿï¼ˆä¼é‡‘ï¼‰",
  outputPath: "/Users/tbab/Desktop/develop/project4/orderSystem/",
  loginCheckInterval: 3000, // ç™»å½•æ£€æµ‹é—´éš”ï¼ˆæ¯«ç§’ï¼‰
  maxLoginWaitTime: 300000, // æœ€å¤§ç­‰å¾…ç™»å½•æ—¶é—´ï¼ˆ5åˆ†é’Ÿï¼‰
  pageTimeout: 10000, // é¡µé¢æ“ä½œè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  clickRetryCount: 3, // ç‚¹å‡»æ“ä½œæœ€å¤§é‡è¯•æ¬¡æ•°
  postLoginWaitTime: 3000, // ç™»å½•åé¢å¤–ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  iframeLoadWaitTime: 2000, // iframe åŠ è½½ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
};
```

## Error Handling

- å¦‚æœç™»å½•è¶…æ—¶ï¼Œæç¤ºç”¨æˆ·å¹¶ç»§ç»­å°è¯•
- **å¦‚æœæŸä¸ªå·¥å•æå–å¤±è´¥**ï¼š
  - è®°å½•é”™è¯¯ä¿¡æ¯å’Œå·¥å•ç´¢å¼•
  - **ä¸é€’å¢ globalIndex**ï¼ˆé¿å…ç´¢å¼•è·³è·ƒï¼‰
  - **å°è¯•å…³é—­æ ‡ç­¾é¡µ**ï¼šä½¿ç”¨ `.catch(() => {})` å¿½ç•¥é”™è¯¯
  - ç‚¹å‡»"å¾…å¤„ç†ä»»åŠ¡"è¿”å›å·¥å•åˆ—è¡¨
  - ç­‰å¾… `page.waitForLoadState('networkidle')`
  - ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªå·¥å•
- å¦‚æœé¡µé¢è·³è½¬å¤±è´¥ï¼Œå°è¯•é‡æ–°å¯¼èˆª
- **å¦‚æœå…³é”®ç‚¹å‡»æ“ä½œå¤±è´¥**ï¼ˆé¡¶éƒ¨èœå•ã€å·¥å•ç³»ç»Ÿå…¥å£ç­‰ï¼‰ï¼š
  - è‡ªåŠ¨é‡è¯•æœ€å¤š 1 æ¬¡
  - æ¯æ¬¡é‡è¯•å‰ç­‰å¾… 2 ç§’
  - å¦‚æœè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ŒæŠ›å‡ºé”™è¯¯å¹¶ç»ˆæ­¢æ‰§è¡Œ
- æ‰€æœ‰é”™è¯¯éƒ½è¦è®°å½•åˆ°æ—¥å¿—ä¸­

### å·²çŸ¥é—®é¢˜

1. **å·¥å•æå–é—æ¼é—®é¢˜**ï¼š
   - æŸäº›å·¥å•åœ¨æå–æ—¶å¯èƒ½å› ä¸ºé¡µé¢åŠ è½½é—®é¢˜æˆ–å…ƒç´ å®šä½å¤±è´¥è€Œè¢«è·³è¿‡
   - è„šæœ¬å·²ä¼˜åŒ–ç´¢å¼•ç®¡ç†ï¼šåªæœ‰æˆåŠŸæå–æ•°æ®åæ‰é€’å¢ç´¢å¼•
   - å»ºè®®ï¼šæå–å®Œæˆåå¯¹æ¯”é¢„æœŸæ•°é‡å’Œå®é™…æ•°é‡ï¼Œå¦‚æœ‰é—æ¼éœ€é‡æ–°æå–

## Output Format

è¾“å‡º CSV æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰æå–çš„å·¥å•æ•°æ®ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```csv
ä»»åŠ¡å•ç¼–å·,ä¸šåŠ¡ç±»å‹,äº§å“ç±»å‹,ä¼ä¸šåç§°,å®¢æˆ·åç§°,CCIF,ECIF,æ ¸èº«é€šè¿‡,äº§å“1,äº§å“2,äº§å“3,äº§å“4,æ•°æ®ç±»å‹
E1234567890,è´·æ¬¾äº§å“å–æ¶ˆé¢åº¦,ä¼ä¸šè´·ï¼ˆå«è€ä¸ªè´·ï¼‰,æµ‹è¯•å…¬å¸,,9999960003313291,,æ˜¯,ä¼ä¸šè´·,,,,ä¼ä¸š
```

## Technical Implementation

- ä½¿ç”¨ Playwright MCP çš„ `browser_run_code` å·¥å…·æ‰§è¡Œå¤æ‚çš„è‡ªåŠ¨åŒ–é€»è¾‘
- åœ¨ iframe ä¸­æ“ä½œæ—¶ï¼Œä½¿ç”¨ `page.frameLocator('iframe')`
- å°çœ¼ç›æŒ‰é’®çš„å®šä½ï¼š`.fes-modal-wrapper .fes-grid .fes-grid-item:nth-child(2) button.fes-btn-type-link`
- å¼¹çª—å…³é—­æŒ‰é’®ï¼š`.fes-modal-wrapper .fes-modal-close`
- è¿”å›åˆ—è¡¨ï¼šç‚¹å‡»"å¾…å¤„ç†ä»»åŠ¡"æ ‡ç­¾

### Playwright MCP å·¥å…·æ­£ç¡®ç”¨æ³•

#### 1. `browser_run_code` å·¥å…·

**å‚æ•°æ ¼å¼**ï¼š
```json
{
  "code": "å®Œæ•´çš„ JavaScript ä»£ç å­—ç¬¦ä¸²"
}
```

**é‡è¦è§„åˆ™**ï¼š
- âœ… `code` å‚æ•°å¿…é¡»æ˜¯**å­—ç¬¦ä¸²ç±»å‹**
- âœ… ä»£ç ä¸­å¯ä»¥ä½¿ç”¨ `page` å¯¹è±¡ï¼ˆPlaywright Page å®ä¾‹ï¼‰
- âœ… ä»£ç ä¸­å¯ä»¥ä½¿ç”¨ `await`ã€`async`ã€`const`ã€`let` ç­‰
- âœ… å¤šè¡Œä»£ç ç”¨ `\n` åˆ†éš”
- âœ… å­—ç¬¦ä¸²ä¸­çš„å¼•å·éœ€è¦è½¬ä¹‰ï¼š`\"` æˆ–ä½¿ç”¨å•å¼•å· `'`
- âŒ **ä¸è¦**ç›´æ¥å†™ä»£ç ï¼Œå¿…é¡»æ”¾åœ¨å­—ç¬¦ä¸²ä¸­

**æ­£ç¡®ç¤ºä¾‹**ï¼š
```javascript
// âœ… æ­£ç¡®ï¼šæ£€æµ‹ç™»å½•çŠ¶æ€
{
  "code": "const url = page.url();\nconst title = await page.title();\nconst isLoggedIn = !url.includes('/pmbank-um/') && !title.includes('ç»Ÿä¸€ç™»å½•å¹³å°');\nreturn { isLoggedIn, url, title };"
}

// âœ… æ­£ç¡®ï¼šç­‰å¾…é¡µé¢åŠ è½½
{
  "code": "await page.waitForLoadState('networkidle');\nawait new Promise(resolve => setTimeout(resolve, 1000));\nreturn 'é¡µé¢åŠ è½½å®Œæˆ';"
}

// âœ… æ­£ç¡®ï¼šç‚¹å‡»å…ƒç´ ï¼ˆå¸¦é‡è¯•ï¼‰
{
  "code": "async function clickWithRetry(selector, maxRetries = 1) {\n  for (let i = 0; i <= maxRetries; i++) {\n    try {\n      await page.locator(selector).waitFor({ state: 'visible', timeout: 2000 });\n      await page.locator(selector).waitFor({ state: 'attached', timeout: 2000 });\n      await page.locator(selector).click({ timeout: 2000 });\n      return true;\n    } catch (e) {\n      if (i === maxRetries) throw e;\n      await new Promise(resolve => setTimeout(resolve, 2000));\n    }\n  }\n}\nawait clickWithRetry('svg').first();\nreturn 'ç‚¹å‡»æˆåŠŸ';"
}
```

**é”™è¯¯ç¤ºä¾‹**ï¼ˆä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ï¼‰ï¼š
```javascript
// âŒ é”™è¯¯ï¼šç›´æ¥å†™ä»£ç 
async function checkLoginStatus() {
  const url = page.url();
  return url;
}

// âŒ é”™è¯¯ï¼šæ²¡æœ‰ code å‚æ•°
{
  "function": "async () => { ... }"
}
```

#### 2. `browser_evaluate` å·¥å…·

**å‚æ•°æ ¼å¼**ï¼š
```json
{
  "function": "() => { return document.title; }",
  "args": []  // å¯é€‰
}
```

**é‡è¦è§„åˆ™**ï¼š
- âœ… `function` å‚æ•°å¿…é¡»æ˜¯**å­—ç¬¦ä¸²ç±»å‹**ï¼ŒåŒ…å«å‡½æ•°å®šä¹‰
- âœ… å‡½æ•°å¯ä»¥æ˜¯ç®­å¤´å‡½æ•°æˆ–æ™®é€šå‡½æ•°
- âœ… å¯ä»¥ä½¿ç”¨ `args` å‚æ•°ä¼ é€’å…ƒç´  UID ç­‰å‚æ•°
- âŒ **ä¸è¦**ä¼ é€’ `undefined` æˆ–ç›´æ¥ä¼ ä»£ç 

**æ­£ç¡®ç¤ºä¾‹**ï¼š
```javascript
// âœ… æ­£ç¡®ï¼šæå–å¼¹çª—æ•°æ®
{
  "function": "(el) => { const labels = el.querySelectorAll('.fes-form-item-label'); const values = el.querySelectorAll('.fes-form-item-content'); const data = {}; for (let i = 0; i < labels.length; i++) { const label = labels[i].textContent.trim(); const value = values[i].textContent.trim(); if (label.includes('ä¸šåŠ¡ç±»å‹')) data.businessType = value; } return data; }",
  "args": [{"uid": "modal-element-uid"}]
}

// âœ… æ­£ç¡®ï¼šç®€å•æå–
{
  "function": "() => { return document.title; }"
}
```

**é”™è¯¯ç¤ºä¾‹**ï¼š
```javascript
// âŒ é”™è¯¯ï¼šfunction å‚æ•°ä¸º undefined
{
  "function": undefined
}

// âŒ é”™è¯¯ï¼šç›´æ¥ä¼ ä»£ç 
{
  "code": "const url = window.location.href;"
}
```

#### 3. å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

**é”™è¯¯ 1**ï¼š`SyntaxError: Unexpected token 'async'`
- **åŸå› **ï¼šç›´æ¥å†™ä»£ç ï¼Œæ²¡æœ‰æ”¾åœ¨å­—ç¬¦ä¸²ä¸­
- **è§£å†³**ï¼šå°†ä»£ç æ”¾åœ¨ `code` å‚æ•°çš„å­—ç¬¦ä¸²ä¸­

**é”™è¯¯ 2**ï¼š`SyntaxError: Unexpected token 'const'`
- **åŸå› **ï¼šåŒä¸Š
- **è§£å†³**ï¼šå°†ä»£ç æ”¾åœ¨ `code` å‚æ•°çš„å­—ç¬¦ä¸²ä¸­

**é”™è¯¯ 3**ï¼š`Invalid input: expected string, received undefined`
- **åŸå› **ï¼š`browser_evaluate` çš„ `function` å‚æ•°ä¸º `undefined`
- **è§£å†³**ï¼šç¡®ä¿ `function` å‚æ•°æ˜¯å­—ç¬¦ä¸²

**é”™è¯¯ 4**ï¼šä»£ç ä¸­çš„å¼•å·é—®é¢˜
- **åŸå› **ï¼šå­—ç¬¦ä¸²ä¸­çš„å¼•å·æ²¡æœ‰æ­£ç¡®è½¬ä¹‰
- **è§£å†³**ï¼šä½¿ç”¨ `\"` è½¬ä¹‰åŒå¼•å·ï¼Œæˆ–ä½¿ç”¨å•å¼•å· `'`

### å…³é”®ä¼˜åŒ–ç‚¹

1. **æ™ºèƒ½ç­‰å¾…ä¸»ç•Œé¢åŠ è½½ç­–ç•¥** (`waitForMainPageReady` å‡½æ•°)ï¼š

   - æ£€æµ‹åˆ°ç™»å½•æˆåŠŸåï¼Œæ‰§è¡Œ `page.waitForLoadState('networkidle')`
   - ç­‰å¾…å…³é”®å…ƒç´ ï¼ˆé¡¶éƒ¨èœå• SVGï¼‰å¯è§ï¼Œè¶…æ—¶ 10 ç§’
   - **æ™ºèƒ½æ£€æµ‹é¡µé¢ç¨³å®šæ€§**ï¼š
     - æ¯ 500ms æ£€æŸ¥ä¸€æ¬¡é¡µé¢ DOM å¤§å°
     - è¿ç»­ 3 æ¬¡æ£€æŸ¥æ— å˜åŒ–åˆ™è®¤ä¸ºé¡µé¢å·²ç¨³å®š
     - æœ€å¤šæ£€æŸ¥ 10 æ¬¡ï¼ˆ5 ç§’ï¼‰
   - æœ€åç­‰å¾… 1 ç§’ç¡®ä¿å®Œå…¨ç¨³å®š
   - é¿å…åœ¨é¡µé¢æœªå®Œå…¨åŠ è½½æ—¶ç‚¹å‡»èœå•å¯¼è‡´å¡é¡¿æˆ–å¤±è´¥

2. **å¸¦é‡è¯•æœºåˆ¶çš„ç‚¹å‡»å‡½æ•°** (`clickWithRetry`)ï¼š

   - æœ€å¤šé‡è¯• 1 æ¬¡
   - æ¯æ¬¡ç‚¹å‡»å‰ç­‰å¾…å…ƒç´ å¯è§å’Œå¯ç‚¹å‡»
   - å¤±è´¥åç­‰å¾… 2 ç§’å†é‡è¯•
   - è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºä¾¿äºè°ƒè¯•

3. **å…³é”®æ“ä½œçš„è¶…æ—¶è®¾ç½®**ï¼š

   - å…ƒç´ å¯è§æ€§æ£€æŸ¥ï¼š2 ç§’è¶…æ—¶
   - å…ƒç´ å¯ç‚¹å‡»æ£€æŸ¥ï¼š2 ç§’è¶…æ—¶
   - ç‚¹å‡»æ“ä½œï¼š2 ç§’è¶…æ—¶
   - "å¾…å¤„ç†ä»»åŠ¡"ç‚¹å‡»ï¼š3 ç§’è¶…æ—¶

4. **é¡µé¢åŠ è½½ç­‰å¾…**ï¼š
   - ç‚¹å‡»"å·¥å•ç³»ç»Ÿï¼ˆä¼é‡‘ï¼‰"åç­‰å¾… `networkidle` + 2 ç§’ï¼ˆç¡®ä¿ iframe åŠ è½½ï¼‰
   - ç‚¹å‡»"å¾…å¤„ç†ä»»åŠ¡"åç­‰å¾… `networkidle` + 1 ç§’

## å‚è€ƒå®ç°

å®Œæ•´çš„å®ç°ä»£ç å‚è§ï¼š`.claude/skills/workorder-system/extract-workorders-script.js`

### æ•°æ®æå–ä»£ç ç¤ºä¾‹

```javascript
// æå–å¼¹çª—æ•°æ®ï¼ˆåŒ…å«æ•°æ®æ¸…ç†ï¼‰
const workOrderData = await modal.evaluate((el) => {
  // æ¸…ç†æ–‡æœ¬å‡½æ•°
  function cleanText(text) {
    if (!text) return text;
    text = text.replace(/^"(.*)"$/, '$1'); // å»é™¤å¤–å±‚å¼•å·
    text = text.replace(/""/g, '"'); // å»é™¤è½¬ä¹‰å¼•å·
    text = text.replace(/[\t\n\r]/g, ''); // å»é™¤åˆ¶è¡¨ç¬¦å’Œæ¢è¡Œç¬¦
    text = text.trim(); // å»é™¤å‰åç©ºæ ¼
    text = text.replace(/^["'\s]+|["'\s]+$/g, ''); // å†æ¬¡æ¸…ç†å¼•å·å’Œç©ºæ ¼
    return text;
  }

  const data = {
    taskId: '',
    businessType: '',
    productType: '',
    companyName: '',
    customerName: '',
    ccif: '',
    ecif: '',
    authPassed: '',
    products: [],
    loanNumbers: [],
    dataType: ''
  };

  // æå–æ‰€æœ‰å­—æ®µ
  const labels = el.querySelectorAll('.fes-form-item-label');
  const values = el.querySelectorAll('.fes-form-item-content');

  for (let i = 0; i < labels.length; i++) {
    const label = labels[i].textContent.trim().replace('ï¼š', '').replace(':', '');
    const value = values[i].textContent.trim();

    if (label.includes('ä¸šåŠ¡ç±»å‹')) data.businessType = value;
    else if (label.includes('äº§å“ç±»å‹')) data.productType = value;
    else if (label.includes('ä¼ä¸šåç§°')) data.companyName = cleanText(value);
    else if (label.includes('å®¢æˆ·åç§°') || label.includes('å§“å')) data.customerName = cleanText(value);
    else if (label.includes('CCIF')) data.ccif = value;
    else if (label.includes('ECIF')) data.ecif = value;
    else if (label.includes('æ ¸èº«é€šè¿‡')) data.authPassed = value;
    else if (label.match(/äº§å“\d+/)) data.products.push(value);
    else if (label.match(/å€Ÿæ®å·\d+/)) data.loanNumbers.push(value);
  }

  // åˆ¤æ–­æ•°æ®ç±»å‹
  if (data.ccif) {
    data.dataType = 'ä¼ä¸š';
  } else if (data.ecif) {
    data.dataType = 'ä¸ªäºº';
  }

  return data;
});

workOrderData.taskId = taskId.trim();
allWorkOrders.push(workOrderData);
```

**å…³é”®æ”¹è¿›ç‚¹**ï¼š
1. åœ¨ `evaluate()` å†…éƒ¨å®šä¹‰ `cleanText()` å‡½æ•°ï¼Œç›´æ¥åœ¨æå–æ—¶æ¸…ç†æ•°æ®
2. åŒæ—¶å°è¯•æå–"å®¢æˆ·åç§°"å’Œ"å§“å"å­—æ®µï¼ˆä½¿ç”¨ `||` è¿ç®—ç¬¦ï¼‰
3. å¯¹ä¼ä¸šåç§°å’Œå®¢æˆ·åç§°éƒ½åº”ç”¨ `cleanText()` æ¸…ç†

### è¾…åŠ©è„šæœ¬

**CSV ç”Ÿæˆè„šæœ¬**ï¼š`.claude/skills/workorder-system/generate-csv.js`

åŠŸèƒ½ï¼š

- ä» JSON æ•°æ®ç”Ÿæˆ CSV æ–‡ä»¶
- åŠ¨æ€è®¡ç®—åˆ—æ•°ï¼ˆæ ¹æ®å®é™…æ•°æ®ï¼‰
- è‡ªåŠ¨æ¸…ç†ç‰¹æ®Šå­—ç¬¦
- æŒ‰ä¸šåŠ¡ç±»å‹åˆ†ç»„å¯¼å‡º

ä½¿ç”¨æ–¹æ³•ï¼š

```bash
node .claude/skills/workorder-system/generate-csv.js workorders_raw.json [è¾“å‡ºç›®å½•]
```

å¯¼å‡ºçš„å‡½æ•°ï¼š

- `cleanText(text)` - æ¸…ç†æ–‡æœ¬ä¸­çš„ç‰¹æ®Šå­—ç¬¦
- `getMaxFieldCount(tickets, fieldPrefix)` - è®¡ç®—æœ€å¤§å­—æ®µæ•°
- `generateCSV(inputFile, outputDir)` - ç”Ÿæˆ CSV æ–‡ä»¶

## Example Usage

**åœºæ™¯ 1ï¼šå•ç‹¬æå–å·¥å•**

```
ç”¨æˆ·: "å¸®æˆ‘æå–å·¥å•ç³»ç»Ÿçš„æ‰€æœ‰å¾…åŠå·¥å•"
Claude: [è°ƒç”¨ workorder-system skill]
è¾“å‡º: workorders.csv
```

**åœºæ™¯ 2ï¼šä½œä¸ºæµç¨‹çš„ä¸€éƒ¨åˆ†**

```
ç”¨æˆ·: "å¤„ç†å–æ¶ˆé¢åº¦å·¥å•"
Claude: [è‡ªåŠ¨ç»„åˆå¤šä¸ª skillsï¼Œé¦–å…ˆè°ƒç”¨ workorder-system]
```

## Notes

- æ­¤ skill ä¸“æ³¨äºå·¥å•ç³»ç»Ÿçš„æ•°æ®æå–èƒ½åŠ›
- ä¸åŒ…å«æ•°æ®åˆ†ææˆ–æŠ¥å‘Šç”ŸæˆåŠŸèƒ½ï¼ˆç”±å…¶ä»– skills è´Ÿè´£ï¼‰
- è¾“å‡ºçš„ CSV æ–‡ä»¶å¯ä»¥è¢«å…¶ä»– skills è¯»å–å’Œå¤„ç†
- æ”¯æŒä¸å…¶ä»–ç³»ç»Ÿ skills çµæ´»ç»„åˆä½¿ç”¨

## æ•°æ®æ¸…ç†

æå–çš„æ•°æ®å¯èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œéœ€è¦è¿›è¡Œæ¸…ç†ï¼š

### å¸¸è§é—®é¢˜

- ä¼ä¸šåç§°å¯èƒ½å‡ºç°ï¼š`""\t æµ‹å¹¿å·å¸‚è‰¯æ ¹æ–§èƒæ²¿æŠ«è¡”ä¿è‚¡ä»½æœ‰é™å…¬å¸""`
- æ¸…ç†ååº”è¯¥æ˜¯ï¼š`æµ‹å¹¿å·å¸‚è‰¯æ ¹æ–§èƒæ²¿æŠ«è¡”ä¿è‚¡ä»½æœ‰é™å…¬å¸`

### æ¸…ç†æ–¹æ³•

**æ¨èä½¿ç”¨ `generate-csv.js` è„šæœ¬è‡ªåŠ¨æ¸…ç†**ï¼Œè¯¥è„šæœ¬åŒ…å« `cleanText()` å‡½æ•°ï¼š

```javascript
function cleanText(text) {
  if (!text) return text;
  text = text.replace(/^"(.*)"$/, "$1"); // å»é™¤å¤–å±‚å¼•å·
  text = text.replace(/""/g, '"'); // å»é™¤è½¬ä¹‰å¼•å·
  text = text.replace(/[\t\n\r]/g, ""); // å»é™¤åˆ¶è¡¨ç¬¦å’Œæ¢è¡Œç¬¦
  text = text.trim(); // å»é™¤å‰åç©ºæ ¼
  text = text.replace(/^["'\s]+|["'\s]+$/g, ""); // å†æ¬¡æ¸…ç†å¼•å·å’Œç©ºæ ¼
  return text;
}
```

### æ¸…ç†æ—¶æœº

- **æ¨è**ï¼šä½¿ç”¨ `generate-csv.js` è„šæœ¬ç”Ÿæˆ CSV æ—¶è‡ªåŠ¨æ¸…ç†
- æˆ–è€…åœ¨æå–æ•°æ®æ—¶ç«‹å³æ¸…ç†ï¼ˆåœ¨ `extract-workorders-script.js` ä¸­ï¼‰
